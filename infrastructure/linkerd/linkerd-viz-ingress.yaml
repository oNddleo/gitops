apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: linkerd-viz-dashboard
  namespace: linkerd-viz
  labels:
    app: linkerd-viz
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`linkerd.example.com`)  # UPDATE THIS
      kind: Rule
      services:
        - name: web
          namespace: linkerd-viz
          port: 8084
      middlewares:
        - name: linkerd-auth
        - name: linkerd-ipwhitelist
  tls:
    secretName: linkerd-viz-tls
---
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: linkerd-auth
  namespace: linkerd-viz
spec:
  basicAuth:
    secret: linkerd-viz-auth
---
apiVersion: v1
kind: Secret
metadata:
  name: linkerd-viz-auth
  namespace: linkerd-viz
type: Opaque
stringData:
  # Default: admin/changeme
  # Generated using: htpasswd -nb admin changeme
  users: |
    admin:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/
---
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: linkerd-ipwhitelist
  namespace: linkerd-viz
spec:
  ipWhiteList:
    sourceRange:
      - 10.0.0.0/8
      - 172.16.0.0/12
      - 192.168.0.0/16
      # - YOUR_OFFICE_IP/32
